# ParagraphBuilder エッジケース確認リスト

## 実施日: 2025-09-02
## 作成者: Claude Code

## 確認すべきエッジケース

### 1. 短い発話の処理
- [ ] 20秒未満で話が終わった場合
- [ ] 1-2セグメントしかない場合
- [ ] セッション開始直後の終了

### 2. 長時間無音の処理
- [ ] 2秒以上の無音後の復帰
- [ ] 講義の休憩時間（5-10分）
- [ ] マイクミュート時の動作

### 3. セッション終了時の処理
- [ ] 未完成パラグラフのflush処理
- [ ] 高品質翻訳の完了待ち
- [ ] メモリクリーンアップ

### 4. 並列処理の整合性
- [ ] SentenceCombinerとの同時動作
- [ ] 同じセグメントの重複処理防止
- [ ] イベント発行の順序性

### 5. パフォーマンスへの影響
- [ ] メモリ使用量（30-60秒分のテキスト保持）
- [ ] CPU使用率（テキストクリーン処理）
- [ ] 180分セッションでのメモリリーク

### 6. エラーハンドリング
- [ ] 翻訳APIエラー時の動作
- [ ] 不正なセグメントデータ
- [ ] イベント発行の失敗

### 7. UI表示の整合性
- [ ] パラグラフと文の混在表示
- [ ] 翻訳の遅延表示
- [ ] スクロール位置の保持

### 8. 言語別の考慮
- [ ] 日本語の句読点検出
- [ ] 中国語・韓国語の文区切り
- [ ] RTL言語（アラビア語等）

## テストシナリオ

### シナリオ1: 短い講義（5分）
1. 3分話す
2. 1分無音
3. 1分話す
4. 終了

期待結果: 2つのパラグラフが生成

### シナリオ2: 断続的な発話
1. 10秒話す
2. 3秒無音
3. 10秒話す
4. 繰り返し

期待結果: 無音で適切に区切られる

### シナリオ3: 高速発話
1. 休みなく5分話し続ける
2. 60秒ごとにパラグラフ区切り

期待結果: 時間ベースで区切られる

### シナリオ4: マルチ言語切り替え
1. 英語で30秒
2. 日本語で30秒
3. 混在した発話

期待結果: 言語に関わらず正しく処理

## 検証方法

1. **単体テスト拡張**
   - エッジケース用のテストケース追加
   - モックを使った異常系テスト

2. **統合テスト**
   - 実際の音声ファイルを使用
   - 各シナリオの自動実行

3. **手動テスト**
   - 開発環境での実機確認
   - ログ分析とメトリクス収集

4. **負荷テスト**
   - 長時間実行テスト
   - メモリプロファイリング

## リスクと対策

| リスク | 影響度 | 対策 |
|--------|--------|------|
| メモリリーク | 高 | 定期的なクリーンアップ実装 |
| 翻訳遅延 | 中 | タイムアウト処理の実装 |
| UI崩れ | 低 | CSSの調整 |

## 次のアクション

1. エッジケーステストの実装
2. 統合テストの実行
3. 実機での動作確認
4. パフォーマンス計測
5. ドキュメント更新