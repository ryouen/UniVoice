# ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ãƒ¢ãƒ¼ãƒ‰å®Ÿè£…ã‚µãƒãƒªãƒ¼

## å®Ÿæ–½æ—¥: 2025-09-03
## å®Ÿè£…è€…: Claude Code
## æœ€çµ‚æ›´æ–°: 2025-09-10ï¼ˆå®Ÿè£…çŠ¶æ³ã®å†èª¿æŸ»ã«ã‚ˆã‚Šæ›´æ–°ï¼‰

## ğŸ”´ é‡è¦ï¼šç¾åœ¨ã®å®Ÿè£…çŠ¶æ³

**ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ãƒ¢ãƒ¼ãƒ‰ã¯ç¾åœ¨ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™**ã€‚å®Ÿéš›ã®ã‚³ãƒ¼ãƒ‰èª¿æŸ»ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã®äº‹å®ŸãŒåˆ¤æ˜ã—ã¾ã—ãŸï¼š

1. **ParagraphBuilderã¯ç„¡åŠ¹åŒ–**
   - UnifiedPipelineServiceã§ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¨åˆæœŸåŒ–ãŒã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
   - ã‚³ãƒ¡ãƒ³ãƒˆ: "ğŸ”´ ParagraphBuilderã‚’ä¸€æ™‚çš„ã«ç„¡åŠ¹åŒ– - ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–ã‚’å„ªå…ˆ"

2. **SentenceCombinerãŒæœ‰åŠ¹**
   - 1-10ã‚»ã‚°ãƒ¡ãƒ³ãƒˆï¼ˆ0.8-8ç§’ï¼‰å˜ä½ã§æ–‡ã‚’çµåˆ
   - combinedSentenceã‚¤ãƒ™ãƒ³ãƒˆãŒæœ‰åŠ¹ã§å±¥æ­´ã«è¿½åŠ 

3. **ç¾åœ¨ã®å±¥æ­´è¡¨ç¤º**
   - FlexibleHistoryGrouperãŒ3-5æ–‡ã§ã‚°ãƒ«ãƒ¼ãƒ—åŒ–
   - å„æ–‡ãŒçŸ­ã„ãŸã‚ã€1-2æ–‡ç¨‹åº¦ã®çŸ­ã„è¡¨ç¤ºã«ãªã£ã¦ã„ã‚‹

## å½“åˆã®è¨ˆç”»ï¼ˆæœªå®Ÿè£…ï¼‰

### æ¦‚è¦
UniVoice 2.0ã®å±¥æ­´è¡¨ç¤ºã‚’æ–‡å˜ä½ï¼ˆ1-2ç§’ï¼‰ã‹ã‚‰ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•å˜ä½ï¼ˆ10-60ç§’ï¼‰ã«å¤‰æ›´ã—ã€ã‚ˆã‚Šèª­ã¿ã‚„ã™ã„å±¥æ­´ã‚’å®Ÿç¾ã™ã‚‹è¨ˆç”»ã§ã—ãŸã€‚

### å•é¡Œç‚¹
1. **ç´°åˆ‡ã‚Œè¡¨ç¤º**: 1æ–‡ãšã¤ãƒ–ãƒ­ãƒƒã‚¯ã«ãªã‚Šã€èª­ã¿ã«ãã„
2. **é‡è¤‡è¡¨ç¤º**: åŒã˜å†…å®¹ãŒè¤‡æ•°å›è¡¨ç¤ºã•ã‚Œã‚‹
3. **æ–‡ã®åˆ†æ–­**: æ–‡ãŒé€”ä¸­ã§åˆ‡ã‚Œã¦åˆ¥ãƒ–ãƒ­ãƒƒã‚¯ã«ãªã‚‹
4. **çŸ­ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³å¯¾å¿œ**: 20ç§’æœªæº€ã®ã‚»ãƒƒã‚·ãƒ§ãƒ³ã§å±¥æ­´ãŒæ®‹ã‚‰ãªã„

### è¨ˆç”»ã•ã‚ŒãŸå®Ÿè£…å†…å®¹

#### 1. ParagraphBuilderã®è¨­å®š
```typescript
// electron/services/domain/UnifiedPipelineService.ts
this.paragraphBuilder = new ParagraphBuilder(
  (paragraph) => this.handleParagraphComplete(paragraph),
  {
    minDurationMs: 10000,    // 10ç§’ï¼ˆçŸ­ã„ã‚»ãƒƒã‚·ãƒ§ãƒ³ã«ã‚‚å¯¾å¿œï¼‰
    maxDurationMs: 60000,    // 60ç§’
    silenceThresholdMs: 2000 // 2ç§’
  }
);
```

#### 2. æ–‡å˜ä½ã®å±¥æ­´è¿½åŠ ã‚’ç„¡åŠ¹åŒ–
- translationã‚¤ãƒ™ãƒ³ãƒˆã§ã®å€‹åˆ¥ã‚»ã‚°ãƒ¡ãƒ³ãƒˆè¿½åŠ ã‚’ç„¡åŠ¹åŒ–
- combinedSentenceã‚¤ãƒ™ãƒ³ãƒˆã§ã®æ–‡å˜ä½è¿½åŠ ã‚’ç„¡åŠ¹åŒ–

#### 3. paragraphCompleteã‚¤ãƒ™ãƒ³ãƒˆã®å‡¦ç†
- `historyGrouperRef.current.addParagraph()`ã§ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•å˜ä½è¿½åŠ 
- ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ç¿»è¨³ã‚’ä½å„ªå…ˆåº¦ã§å®Ÿè¡Œ

## å®Ÿéš›ã®å®Ÿè£…çŠ¶æ³ï¼ˆ2025-09-10æ™‚ç‚¹ï¼‰

### ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆUnifiedPipelineService.tsï¼‰
```typescript
// ParagraphBuilderã®ã‚¤ãƒ³ãƒãƒ¼ãƒˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
// import { ParagraphBuilder, Paragraph } from './ParagraphBuilder';

// åˆæœŸåŒ–éƒ¨åˆ†ã‚‚ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
// this.paragraphBuilder = new ParagraphBuilder(...);

// SentenceCombinerã¯æœ‰åŠ¹
this.sentenceCombiner = new SentenceCombiner(
  (combinedSentence) => this.handleCombinedSentence(combinedSentence),
  {
    maxSegments: 10,
    timeoutMs: 2000,
    minSegments: 1  // çŸ­ã„æ–‡ã‚‚å±¥æ­´ã«å«ã‚ã‚‹
  }
);
```

### ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆuseUnifiedPipeline.tsï¼‰
```typescript
// combinedSentenceã‚¤ãƒ™ãƒ³ãƒˆã¯æœ‰åŠ¹
case 'combinedSentence':
  // ã€Phase 1 å¾©æ´»ã€‘SentenceCombinerã«ã‚ˆã‚‹æ–‡å˜ä½ã®å±¥æ­´è¿½åŠ ã‚’å¾©æ´»
  historyGrouperRef.current.addSentence({
    id: event.data.combinedId,
    original: event.data.originalText,
    translation: '',
    timestamp: event.data.timestamp
  });
  break;

// paragraphCompleteã‚¤ãƒ™ãƒ³ãƒˆã¯ã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
// case 'paragraphComplete':
//   ...
```

## ä»Šå¾Œã®æ”¹å–„æ¡ˆ

### 1. ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ãƒ¢ãƒ¼ãƒ‰ã®å†æœ‰åŠ¹åŒ–
- ParagraphBuilderã®ã‚³ãƒ¡ãƒ³ãƒˆã‚’è§£é™¤
- minDurationMs: 30ç§’ã€maxDurationMs: 90ç§’ã«èª¿æ•´
- ã‚ˆã‚Šé•·ã„å˜ä½ã§ã®å±¥æ­´è¡¨ç¤ºã‚’å®Ÿç¾

### 2. ãƒã‚¤ãƒ–ãƒªãƒƒãƒ‰ã‚¢ãƒ—ãƒ­ãƒ¼ãƒ
- çŸ­ã„ç™ºè©±ï¼ˆ10ç§’æœªæº€ï¼‰: SentenceCombinerã§å‡¦ç†
- é•·ã„ç™ºè©±ï¼ˆ10ç§’ä»¥ä¸Šï¼‰: ParagraphBuilderã§å‡¦ç†
- ä¸¡æ–¹ã®åˆ©ç‚¹ã‚’æ´»ç”¨

### 3. UIå´ã§ã®çµ±åˆ
- FlexibleHistoryGrouperã®è¨­å®šã‚’èª¿æ•´
- minSentencesPerBlock: 5ã€maxSentencesPerBlock: 10ã«å¢—åŠ 
- ã‚ˆã‚Šå¤§ããªå˜ä½ã§ã®ã‚°ãƒ«ãƒ¼ãƒ—åŒ–

## å½±éŸ¿ç¯„å›²
- âœ… ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤º: å½±éŸ¿ãªã—ï¼ˆå¾“æ¥é€šã‚Šå‹•ä½œï¼‰
- âŒ å±¥æ­´è¡¨ç¤º: æ–‡å˜ä½ã®ã¾ã¾ï¼ˆãƒ‘ãƒ©ã‚°ãƒ©ãƒ•å˜ä½ã¯æœªå®Ÿè£…ï¼‰
- âœ… è¦ç´„æ©Ÿèƒ½: å½±éŸ¿ãªã—
- âœ… èªå½™æŠ½å‡º: å½±éŸ¿ãªã—
- âœ… æœ€çµ‚ãƒ¬ãƒãƒ¼ãƒˆ: å½±éŸ¿ãªã—

## çµè«–
ãƒ‘ãƒ©ã‚°ãƒ©ãƒ•ãƒ¢ãƒ¼ãƒ‰ã¯è¨ˆç”»ã•ã‚ŒãŸãŒã€ç¾åœ¨ã¯ç„¡åŠ¹åŒ–ã•ã‚Œã¦ã„ã¾ã™ã€‚å±¥æ­´è¡¨ç¤ºã‚’æ”¹å–„ã™ã‚‹ã«ã¯ã€ParagraphBuilderã®å†æœ‰åŠ¹åŒ–ã¾ãŸã¯FlexibleHistoryGrouperã®è¨­å®šèª¿æ•´ãŒå¿…è¦ã§ã™ã€‚