# 理想的なUX設計 - UniVoice 2.0

## 🎯 ユーザーニーズ

### リアルタイム表示
- **目的**: 授業についていく
- **要件**: 
  - 1-3秒程度の遅延で表示
  - 完璧でなくても理解できる翻訳
  - 現在の3段階表示は適切

### 履歴表示
- **目的**: 復習・深い理解
- **要件**:
  - 1-2パラグラフ単位（30秒-1分の内容）
  - クリーンな英文
  - 高品質な翻訳

## 📋 実装方針

### 1. セグメント収集（現状維持）
- 0.8秒ごとのDeepgramセグメント
- リアルタイム翻訳と表示

### 2. パラグラフ生成（新規）
```typescript
interface Paragraph {
  id: string;
  segments: TranscriptSegment[];
  startTime: number;
  endTime: number;
  rawText: string;           // 生の結合テキスト
  cleanedText: string;       // クリーン化されたテキスト
  translation: string;       // 高品質翻訳
  status: 'collecting' | 'processing' | 'completed';
}
```

### 3. クリーン化処理
- フィラー除去: "um", "uh", "ah", "you know"
- 繰り返し除去: "the the" → "the"
- 文の整形: 文頭大文字、適切な句読点
- 文脈による修正: 明らかな誤認識の修正

### 4. パラグラフ区切りの判定
- 時間ベース: 30-60秒
- 内容ベース: 話題の切れ目
- 沈黙検出: 2秒以上の無音
- 最大制限: 2分

## 🔄 処理フロー

```
[Deepgram] 
  ↓ 0.8秒セグメント
[リアルタイム表示] ← gpt-5-nano（速度優先）
  ↓
[セグメント蓄積]
  ↓ 30-60秒または話題の切れ目
[パラグラフ形成]
  ↓
[テキストクリーン化] ← gpt-5-mini（整形用）
  ↓
[高品質翻訳] ← gpt-5-mini（文脈考慮）
  ↓
[履歴表示]
```

## 💡 実装の利点

1. **リアルタイム性を損なわない**
   - 現在の表示はそのまま
   - バックグラウンドで履歴生成

2. **読みやすい履歴**
   - まとまった意味単位
   - きれいな文章
   - 高品質な翻訳

3. **メモリ効率**
   - 細かいセグメントは一時的
   - 履歴はパラグラフ単位で保存

## 🚀 実装ステップ

### Phase 1: 基本実装
1. ParagraphBuilderクラスの作成
2. 時間ベースの区切り（30秒）
3. 基本的なクリーン化

### Phase 2: 品質向上
1. GPTによるテキスト整形
2. 文脈を考慮した翻訳
3. 話題の切れ目検出

### Phase 3: 最適化
1. 動的な区切り判定
2. 専門用語の一貫性
3. 要約との連携