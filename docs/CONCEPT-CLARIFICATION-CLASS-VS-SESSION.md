# クラス（科目）とセッションの概念整理

## 作成日: 2025-09-16
## 作成者: Claude Code

---

## 1. 概念定義

### クラス（科目）- Class/Course
**定義**: 一連の講義の集まり。例：「経済学」「データ構造」「量子力学入門」

**特徴**:
- 通常10-15回程度の講義で構成
- 同一の教員・受講者
- 統一されたシラバス・学習目標
- 最終的に統合されたレポートが必要

### セッション - Recording Session
**定義**: 1回の録音・文字起こしの実行単位

**特徴**:
- 開始から終了までの連続した録音
- 中断・再開が可能
- 通常1-3時間程度
- 1つの講義に複数のセッションが存在可能

### レクチャー（講義）- Lecture
**定義**: 1回の授業（例：第3回講義）

**特徴**:
- 1つのクラスに複数のレクチャーが含まれる
- 1つのレクチャーは1つまたは複数のセッションで記録される
- 日付と回数で識別

---

## 2. 階層構造

```
クラス（経済学）
├── 第1回講義（9月1日）
│   └── セッション1（完了：2時間）
├── 第2回講義（9月8日）
│   ├── セッション1（完了：1時間）
│   └── セッション2（完了：1時間）
├── 第3回講義（9月15日）
│   ├── セッション1（完了：45分）
│   ├── セッション2（中断：30分）← 再開可能
│   └── セッション3（未開始）
└── 第4回講義（9月22日）
    └── （未開始）
```

---

## 3. ユーザーシナリオ

### シナリオ1: 通常の講義録音
1. 「経済学」クラスを選択
2. 「第3回講義」を新規作成または選択
3. セッションを開始して録音
4. 講義終了時にセッションを終了
5. 必要に応じて要約・語彙を確認

### シナリオ2: 長時間講義の分割
1. 3時間の特別講義を録音
2. 1時間経過後、休憩のためセッションを一時終了
3. 休憩後、同じ講義の新しいセッションを開始
4. 最終的に3つのセッションで1つの講義を記録

### シナリオ3: 中断からの再開
1. 録音中にブラウザがクラッシュ
2. 再起動時に「未完了のセッションがあります」と表示
3. 「再開」を選択して、同じセッションの録音を継続
4. 中断前のデータはすべて保持されている

---

## 4. データモデル提案

```typescript
// クラス（科目）
interface Class {
  id: string;
  name: string;                // "経済学"
  instructor?: string;         // "田中教授"
  semester?: string;           // "2025年秋学期"
  createdAt: Date;
  updatedAt: Date;
  settings: {
    defaultSourceLanguage: string;
    defaultTargetLanguage: string;
  };
}

// レクチャー（講義）
interface Lecture {
  id: string;
  classId: string;
  number: number;              // 第N回
  title?: string;              // "需要と供給"
  date: Date;
  sessions: string[];          // セッションIDの配列
  createdAt: Date;
  notes?: string;
}

// セッション（録音単位）
interface RecordingSession {
  id: string;
  lectureId: string;
  status: 'recording' | 'paused' | 'completed' | 'crashed';
  startedAt: Date;
  endedAt?: Date;
  lastActivityAt: Date;
  duration: number;            // 秒数
  segmentCount: number;
  data: {
    segments: TranscriptionSegment[];
    summaries: Summary[];
    vocabulary: VocabularyItem[];
  };
  settings: {
    sourceLanguage: string;
    targetLanguage: string;
  };
}

// 現在のアクティブセッション（アプリの状態）
interface ActiveSessionState {
  classId: string;
  lectureId: string;
  sessionId: string;
  canResume: boolean;          // 再開可能かどうか
}
```

---

## 5. UI/UXの改善提案

### Setup画面の階層化

```
[Setup画面]
1. クラスを選択または新規作成
   - 既存: 経済学 ▼
   - 新規: [クラス名を入力]

2. レクチャーを選択または新規作成
   - 第3回（9/15）- 2セッション記録済み
   - 第4回（9/22）- 未開始
   - [新規レクチャー作成]

3. セッション操作
   - 前回のセッション（30分録音済み）を再開
   - 新しいセッションを開始

[開始] [キャンセル]
```

### セッション管理画面

```
現在のセッション：
クラス：経済学
講義：第3回（9月15日）
セッション：#2（再開）
録音時間：00:45:23
```

---

## 6. 移行計画

### Phase 1: データモデルの拡張（後方互換性維持）
- 既存の`className`は`Class.name`として解釈
- レクチャーは自動的に作成（日付ベース）
- セッションIDを導入

### Phase 2: UI更新
- Setup画面に階層選択を追加
- セッション再開の明示的な選択肢

### Phase 3: 高度な機能
- クラス全体のレポート生成
- レクチャー間の関連性分析
- 学期末の統合サマリー

---

## 7. メリット

1. **明確な概念分離**: ユーザーの混乱を防ぐ
2. **柔軟な録音管理**: 長時間講義の分割、中断・再開
3. **体系的なデータ整理**: クラス→レクチャー→セッションの階層
4. **将来の拡張性**: 複数クラスの管理、学期レポートなど

---

## 8. 実装への影響

### 必要な変更
1. SessionStorageServiceの拡張
2. 新しいドメインモデルの追加
3. UI層の大幅な改修
4. データ永続化層の再設計

### リスク
1. 既存データとの互換性
2. UIの複雑化
3. 学習コストの増加

### 対策
1. 段階的な移行
2. シンプルモードの提供
3. 丁寧なオンボーディング