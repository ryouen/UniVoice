# å‹å®šç¾©åŒæœŸã«é–¢ã™ã‚‹èª¿æŸ»çµæœ

**ä½œæˆæ—¥**: 2025-08-30  
**ä½œæˆè€…**: Claude Code  
**é‡è¦åº¦**: ğŸ”´ HIGH - ãƒ“ãƒ«ãƒ‰ãƒ—ãƒ­ã‚»ã‚¹ã«ç›´æ¥å½±éŸ¿

## ç™ºè¦‹ã•ã‚ŒãŸå•é¡Œ

### 1. å‹å®šç¾©ã®äºŒé‡ç®¡ç†
- **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰**: `electron/services/ipc/contracts.ts` - Zodã‚¹ã‚­ãƒ¼ãƒã«ã‚ˆã‚‹å®Œå…¨ãªå‹å®šç¾©
- **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰**: `src/shared/types/contracts.ts` - æ‰‹å‹•ã§ç°¡ç•¥åŒ–ã•ã‚ŒãŸå‹å®šç¾©
- **å•é¡Œ**: æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ï¼ˆ`combinedSentence`ãªã©ï¼‰ã‚’è¿½åŠ ã™ã‚‹éš›ã€ä¸¡æ–¹ã®ãƒ•ã‚¡ã‚¤ãƒ«ã‚’æ‰‹å‹•ã§æ›´æ–°ã™ã‚‹å¿…è¦ãŒã‚ã‚‹

### 2. ãƒ“ãƒ«ãƒ‰ã‚¨ãƒ©ãƒ¼ã®åŸå› 
```typescript
// ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ã§ã“ã®ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿ
error TS2678: Type '"combinedSentence"' is not comparable to type '"asr" | "translation" | "segment" | "summary" | "error" | "status" | "vocabulary" | "finalReport"'.
```

åŸå› : `src/shared/types/contracts.ts`ã«`combinedSentence`ã‚¿ã‚¤ãƒ—ãŒè¿½åŠ ã•ã‚Œã¦ã„ãªã‹ã£ãŸ

## å®Ÿè£…ã—ãŸè§£æ±ºç­–

### 1. å³æ™‚ä¿®æ­£
`src/shared/types/contracts.ts`ã®PipelineEventã‚¿ã‚¤ãƒ—ã«`'combinedSentence'`ã‚’è¿½åŠ 

### 2. æ’ä¹…çš„è§£æ±ºç­–
è‡ªå‹•åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ`scripts/sync-contracts.js`ã‚’ä½œæˆ:
- ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ã®å‹å®šç¾©ã‹ã‚‰è‡ªå‹•çš„ã«ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ç”¨ã®å‹ã‚’ç”Ÿæˆ
- `npm run sync-contracts`ã§æ‰‹å‹•å®Ÿè¡Œ
- `npm run build`ã®å‰ã«è‡ªå‹•å®Ÿè¡Œï¼ˆprebuildãƒ•ãƒƒã‚¯ï¼‰

## ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã®ç¢ºèªçµæœ

### CombinedSentenceEventã®æµã‚Œ
1. **ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰ï¼ˆUnifiedPipelineServiceï¼‰**:
   - `handleCombinedSentence`ï¼ˆè¡Œ1064ï¼‰ã§ã‚¤ãƒ™ãƒ³ãƒˆç™ºè¡Œ
   - `executeHistoryTranslation`ï¼ˆè¡Œ1117ï¼‰ã§é«˜å“è³ªç¿»è¨³å®Ÿè¡Œ

2. **ãƒ¡ã‚¤ãƒ³ãƒ—ãƒ­ã‚»ã‚¹ï¼ˆmain.tsï¼‰**:
   - IPCGatewayã‚’é€šã˜ã¦ã‚¤ãƒ™ãƒ³ãƒˆã‚’è»¢é€

3. **ãƒ•ãƒ­ãƒ³ãƒˆã‚¨ãƒ³ãƒ‰ï¼ˆuseUnifiedPipelineï¼‰**:
   - è¡Œ617-650ã§`combinedSentence`ã‚¤ãƒ™ãƒ³ãƒˆã‚’å‡¦ç†
   - è¡Œ407-449ã§`history_`ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹ä»˜ãç¿»è¨³ã‚’å‡¦ç†

### é‡è¤‡å®Ÿè£…ã®ç¢ºèª
- âŒ é‡è¤‡ãªã— - å„ãƒ¡ã‚½ãƒƒãƒ‰ã¯1ç®‡æ‰€ã®ã¿å®Ÿè£…ã•ã‚Œã¦ã„ã‚‹

## æ¨å¥¨äº‹é …

### 1. å‹å®šç¾©ã®å®Œå…¨ãªçµ±ä¸€
ç¾åœ¨ã®ç°¡ç•¥åŒ–ã•ã‚ŒãŸå‹å®šç¾©ï¼ˆ`data: any`ï¼‰ã‚’ã€Zodã‚¹ã‚­ãƒ¼ãƒã‹ã‚‰ç”Ÿæˆã•ã‚ŒãŸå®Œå…¨ãªå‹å®šç¾©ã«ç½®ãæ›ãˆã‚‹ã“ã¨ã‚’æ¤œè¨

### 2. CI/CDã¸ã®çµ±åˆ
å‹ã®ä¸æ•´åˆã‚’é˜²ããŸã‚ã€CIãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã«ä»¥ä¸‹ã‚’è¿½åŠ :
```bash
npm run sync-contracts
git diff --exit-code src/shared/types/contracts.ts
```

### 3. é–‹ç™ºãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
æ–°ã—ã„ã‚¤ãƒ™ãƒ³ãƒˆã‚¿ã‚¤ãƒ—ã‚’è¿½åŠ ã™ã‚‹éš›:
1. `electron/services/ipc/contracts.ts`ã«Zodã‚¹ã‚­ãƒ¼ãƒã‚’è¿½åŠ 
2. `npm run sync-contracts`ã‚’å®Ÿè¡Œ
3. ç”Ÿæˆã•ã‚ŒãŸãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚³ãƒŸãƒƒãƒˆ

## é–¢é€£ãƒ•ã‚¡ã‚¤ãƒ«
- `electron/services/ipc/contracts.ts` - ã‚½ãƒ¼ã‚¹ï¼ˆçœŸå®Ÿã®æºï¼‰
- `src/shared/types/contracts.ts` - ç”Ÿæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«
- `scripts/sync-contracts.js` - åŒæœŸã‚¹ã‚¯ãƒªãƒ—ãƒˆ
- `package.json` - sync-contractsã‚³ãƒãƒ³ãƒ‰ã¨prebuildãƒ•ãƒƒã‚¯