# Clean Architecture タスクリスト

作成日: 2025-08-28  
総タスク数: 30  
推定総工数: 45-65時間

## 📋 タスク構造

```
Phase 1: LLM基盤整備（High Priority）
├── Phase 1.1: LLMGateway実装（8-10時間）
├── Phase 1.2: PromptManager実装（4-6時間）
└── Phase 1.3: ModelConfigManager実装（3-4時間）

Phase 2: サービス分割（Medium Priority）
├── Phase 2.1: ContentProcessingService（6-8時間）
├── Phase 2.2: PipelineEventEmitter（4-5時間）
└── Phase 2.3: AudioPipelineOrchestrator（6-8時間）

UI機能実装（Medium Priority）
├── セッションデータ永続化（4-5時間）
└── レポート生成UI（3-4時間）

UI改善（Low Priority）
├── 単語帳表示UI（2-3時間）
└── 履歴UIライトテーマ（1-2時間）
```

## 🚀 Phase 1: LLM基盤整備【High Priority】

### Phase 1.1: LLMGateway基盤（8-10時間）

- [ ] **#100** インターフェース設計（2h）
  - LLMRequest/LLMResponseの型定義
  - エラー型の定義
  - ストリーミング対応インターフェース

- [ ] **#101** 基本実装（complete/stream）（2h）
  - OpenAI Responses API統合
  - 非同期/ストリーミング両対応
  - 基本的なリクエスト/レスポンス処理

- [ ] **#102** エラーハンドリング実装（2h）
  - リトライロジック
  - レート制限対応
  - タイムアウト処理

- [ ] **#103** Shadow Mode統合（2h）
  - 既存実装との並列実行
  - メトリクス比較機能
  - 段階的移行サポート

- [ ] **#104** 単体テスト作成（2h）
  - モックを使用したテスト
  - エラーケースのテスト
  - パフォーマンステスト

### Phase 1.2: PromptManager（4-6時間）

- [ ] **#105** テンプレート構造設計（2h）
  - プロンプトテンプレート形式決定
  - 変数置換システム設計
  - バージョン管理考慮

- [ ] **#106** 多言語対応設計（2h）
  - 16言語対応プロンプト構造
  - 言語別最適化ポイント
  - フォールバック仕組み

- [ ] **#107** 実装とテスト（2h）
  - テンプレートエンジン実装
  - 言語切替機能
  - 単体テスト

### Phase 1.3: ModelConfigManager（3-4時間）

- [ ] **#108** 設定構造設計（1h）
  - モデル設定スキーマ定義
  - 用途別モデルマッピング
  - 設定バリデーション

- [ ] **#109** 環境変数統合（1.5h）
  - .env読み込み
  - デフォルト値管理
  - 実行時オーバーライド

- [ ] **#110** 実装とテスト（1.5h）
  - 設定読み込みロジック
  - バリデーション実装
  - 単体テスト

## 🔧 Phase 2: サービス分割【Medium Priority】

### Phase 2.1: ContentProcessingService（6-8時間）

- [ ] **#200** サービス設計（2h）
  - 責任範囲の明確化
  - インターフェース定義
  - 依存関係整理

- [ ] **#201** LLMGateway統合（3h）
  - 既存のOpenAI呼び出しを置換
  - PromptManager統合
  - エラーハンドリング統一

- [ ] **#202** 既存コード移行（3h）
  - UnifiedPipelineServiceから移動
  - AdvancedFeatureServiceから移動
  - 統合テスト

### Phase 2.2: PipelineEventEmitter（4-5時間）

- [ ] **#203** イベント種別整理（1.5h）
  - 現在のイベント一覧作成
  - イベントフロー図作成
  - 責任範囲定義

- [ ] **#204** 抽出実装（2h）
  - EventEmitterクラス作成
  - イベント型定義
  - 購読/発行メソッド

- [ ] **#205** UnifiedPipelineService統合（1.5h）
  - 既存のemit呼び出しを置換
  - テスト更新
  - 動作確認

### Phase 2.3: AudioPipelineOrchestrator（6-8時間）

- [ ] **#206** 責任範囲定義（2h）
  - UnifiedPipelineServiceの分析
  - 切り出し対象の特定
  - インターフェース設計

- [ ] **#207** コード分割実装（3h）
  - オーケストレーションロジック抽出
  - 依存性注入実装
  - 150行以下を目標

- [ ] **#208** 統合テスト（3h）
  - 全体フロー確認
  - パフォーマンス測定
  - エラーケース確認

## 📱 UI機能実装【Medium Priority】

### セッションデータ永続化（4-5時間）

- [ ] **#300** IndexedDB設計（1.5h）
  - スキーマ定義
  - インデックス設計
  - 容量管理方針

- [ ] **#301** リポジトリ実装（2h）
  - CRUD操作
  - トランザクション管理
  - エラーハンドリング

- [ ] **#302** UI統合（1.5h）
  - 保存/読込UI
  - 進捗表示
  - エラー通知

### レポート生成UI（3-4時間）

- [ ] **#303** モーダル設計（1h）
  - UIデザイン
  - 状態管理
  - アニメーション

- [ ] **#304** Markdownレンダリング（1.5h）
  - ライブラリ選定
  - スタイリング
  - プレビュー機能

- [ ] **#305** エクスポート機能（1.5h）
  - PDF出力
  - HTML出力
  - コピー機能

## 🎨 UI改善【Low Priority】

### 単語帳表示UI（2-3時間）

- [ ] **#400** テーブルコンポーネント作成（1.5h）
  - レスポンシブテーブル
  - ページネーション
  - 選択機能

- [ ] **#401** フィルタ・ソート機能（1.5h）
  - 検索機能
  - カテゴリフィルタ
  - ソート実装

### 履歴UIライトテーマ（1-2時間）

- [ ] **#402** カラースキーム設計（0.5h）
  - 配色決定
  - コントラスト確認
  - アクセシビリティ

- [ ] **#403** CSS実装（1.5h）
  - スタイル更新
  - テーマ切替機能
  - 動作確認

## 📊 進捗管理

### 週次マイルストーン

**Week 1（〜2025-09-04）**
- Phase 1.1 完了（LLMGateway）
- Phase 1.2 開始（PromptManager）

**Week 2（〜2025-09-11）**
- Phase 1.2, 1.3 完了
- Phase 2.1 開始（ContentProcessingService）

**Week 3（〜2025-09-18）**
- Phase 2 進行
- UI機能実装開始

**Week 4（〜2025-09-25）**
- 全タスク完了
- 統合テスト
- ドキュメント更新

### 成功指標

1. **コード品質**
   - UnifiedPipelineService: 500行以下
   - 各サービス: 300行以下
   - テストカバレッジ: 80%以上

2. **パフォーマンス**
   - first paint: ≤1000ms維持
   - メモリ使用量: 現状維持
   - CPU使用率: 改善

3. **保守性**
   - GPT-6移行: 設定変更のみ
   - 新機能追加: 1箇所の変更
   - バグ修正時間: 50%削減