# UniVoice.tsx æ§‹é€ è§£æãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

## ãƒ•ã‚¡ã‚¤ãƒ«æ¦‚è¦
- **ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `src/components/UniVoice.tsx`
- **ç·è¡Œæ•°**: 2777è¡Œï¼ˆ2025-09-21 å†è¨ˆæ¸¬ã€refè¿½åŠ ã«ã‚ˆã‚Š1è¡Œå¢—åŠ ï¼‰
- **ç›®çš„**: å¤§è¦æ¨¡ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®å®Œå…¨æ§‹é€ åˆ†æã¨Clean Architectureãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°æˆ¦ç•¥
- **ä½œæˆæ—¥**: 2025-09-18
- **æœ€çµ‚æ›´æ–°**: 2025-09-21ï¼ˆå‹å®‰å…¨æ€§æ”¹å–„ï¼šå…¨ã¦ã®`as any`é™¤å»ã€document.getElementByIdã®useRefç½®æ›ï¼‰

## ã‚»ã‚¯ã‚·ãƒ§ãƒ³åˆ¥æ§‹é€ 

### 1-200è¡Œ: ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚¤ãƒ³ãƒãƒ¼ãƒˆã€å‹å®šç¾©ã€ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºè¨­è¨ˆãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **1-15è¡Œ**: ãƒ•ã‚¡ã‚¤ãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼ã‚³ãƒ¡ãƒ³ãƒˆï¼ˆå®Ÿè£…æ¸ˆã¿æ©Ÿèƒ½ãƒªã‚¹ãƒˆï¼‰
- **17-36è¡Œ**: ã‚¤ãƒ³ãƒãƒ¼ãƒˆæ–‡
  - Reacté–¢é€£
  - ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ï¼ˆuseUnifiedPipeline, useSessionMemoryï¼‰
  - ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆï¼ˆSetupSection, RealtimeSectionç­‰ï¼‰
  - ã‚µãƒ¼ãƒ“ã‚¹ï¼ˆsessionStorageService, WindowClientï¼‰
- **41-56è¡Œ**: å‹å®šç¾©ï¼ˆHistoryEntry, MockUpdateï¼‰
- **58-109è¡Œ**: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºç®¡ç†ã‚·ã‚¹ãƒ†ãƒ ã®è©³ç´°ãªãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- **111-198è¡Œ**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³å®šç¾©ï¼ˆSECTION_DEFINITIONS, LAYOUT_HEIGHTSï¼‰

### 200-400è¡Œ: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆå®šç¾©ã¨çŠ¶æ…‹ç®¡ç†
- **200-222è¡Œ**: UniVoicePropsã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹å®šç¾©
- **227-237è¡Œ**: UniVoiceã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆé–¢æ•°ã®é–‹å§‹ã€propsã®åˆ†è§£
- **240-244è¡Œ**: activeSessionçŠ¶æ…‹ï¼ˆåˆæœŸå€¤: nullï¼‰
- **247-259è¡Œ**: previousSessionçŠ¶æ…‹ï¼ˆSessionStorageServiceã‹ã‚‰å¾©å…ƒï¼‰
- **264è¡Œ**: showSetupçŠ¶æ…‹ï¼ˆåˆæœŸå€¤: !activeSession = trueï¼‰
- **265-268è¡Œ**: ãã®ä»–ã®åŸºæœ¬çŠ¶æ…‹ï¼ˆselectedClass, isPaused, recordingTimeç­‰ï¼‰
- **270-283è¡Œ**: activeSessionå¤‰æ›´æ™‚ã®ãƒ­ã‚°ã¨æ°¸ç¶šåŒ–
- **285-288è¡Œ**: ğŸ”´ é‡è¦: showSetupã‚’activeSessionã«é€£å‹•ã•ã›ã‚‹useEffect
- **290-311è¡Œ**: ğŸ”´ é‡è¦: åˆæœŸåŒ–æ™‚ã®å¼·åˆ¶Setupç”»é¢è¡¨ç¤ºuseEffect
- **314-330è¡Œ**: è¨€èªè¨­å®šã®çŠ¶æ…‹ç®¡ç†
- **333-396è¡Œ**: UIé–¢é€£ã®å„ç¨®çŠ¶æ…‹ï¼ˆexpandedSection, ãƒ¢ãƒ¼ãƒ€ãƒ«, ãƒ•ã‚©ãƒ³ãƒˆç­‰ï¼‰

### 400-600è¡Œ: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³è¨­å®šã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³é–‹å§‹å‡¦ç†
- **398-407è¡Œ**: ãƒªã‚µã‚¤ã‚ºãƒ¢ãƒ¼ãƒ‰ç®¡ç†
- **431è¡Œ**: WindowClientã‚¤ãƒ³ã‚¹ã‚¿ãƒ³ã‚¹å–å¾—
- **439-453è¡Œ**: useUnifiedPipelineãƒ•ãƒƒã‚¯ã®è¨­å®š
- **456è¡Œ**: useSessionMemoryãƒ•ãƒƒã‚¯
- **458-472è¡Œ**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã‹ã‚‰ã®ãƒ‡ãƒ¼ã‚¿çµ±åˆ
- **481-516è¡Œ**: beforeunloadã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼ï¼ˆç•°å¸¸çµ‚äº†å¯¾ç­–ï¼‰
- **519-520è¡Œ**: isStartingPipelineçŠ¶æ…‹
- **522-623è¡Œ**: ğŸ”´ é‡è¦: handleStartSessioné–¢æ•°ï¼ˆSetupç”»é¢ã‹ã‚‰å‘¼ã°ã‚Œã‚‹ï¼‰

### 600-800è¡Œ: ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹ã¨çµ‚äº†å‡¦ç†
- **625-800è¡Œ**: handleResumeSessioné–¢æ•°ï¼ˆã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹å‡¦ç†ï¼‰

### 800-1000è¡Œ: ã‚»ãƒƒã‚·ãƒ§ãƒ³çµ‚äº†ã¨ãƒ‡ã‚£ã‚¹ãƒ—ãƒ¬ã‚¤ã‚³ãƒ³ãƒ†ãƒ³ãƒ„æ§‹ç¯‰
- **802-846è¡Œ**: handleEndSessioné–¢æ•°
- **849-886è¡Œ**: nextClassé–¢æ•°ï¼ˆæ¬¡ã®æˆæ¥­ã¸ç§»è¡Œï¼‰
- **889-891è¡Œ**: endSessioné–¢æ•°
- **900-996è¡Œ**: displayContentã®ãƒ¡ãƒ¢åŒ–å‡¦ç†

### 1000-1200è¡Œ: å±¥æ­´ãƒ‡ãƒ¼ã‚¿ç®¡ç†ã¨é‡è¤‡handleStartSession
- **1000-1013è¡Œ**: pipeline.historyã‹ã‚‰historyEntriesã¸ã®æ›´æ–°
- **1015-1022è¡Œ**: å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ
- **1025-1049è¡Œ**: ğŸ”´ é‡è¦: handleStartSessionã®é‡è¤‡å®šç¾©ï¼ˆç°¡ç•¥åŒ–ã•ã‚ŒãŸãƒãƒ¼ã‚¸ãƒ§ãƒ³ï¼‰
- **1052-1055è¡Œ**: handleResumeSessionã®ç°¡ç•¥ç‰ˆ
- **1058-1069è¡Œ**: endSessionã®ç°¡ç•¥ç‰ˆ
- **1072-1076è¡Œ**: nextClassã®ç°¡ç•¥ç‰ˆ
- **1078-1087è¡Œ**: Refå¤‰æ•°ã®å®šç¾©
- **1089-1165è¡Œ**: å›ºå®šã‚»ã‚¯ã‚·ãƒ§ãƒ³é«˜ã•è¨ˆç®—é–¢æ•°
- **1167-1207è¡Œ**: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºå®Ÿè¡Œé–¢æ•°

### 1200-1400è¡Œ: ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºç®¡ç†
- **1209-1259è¡Œ**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³è¡¨ç¤ºçŠ¶æ…‹å¤‰æ›´æ™‚ã®ãƒªã‚µã‚¤ã‚ºå‡¦ç†
- **1261-1345è¡Œ**: ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ‰ãƒ©ãƒƒã‚°ã«ã‚ˆã‚‹ãƒªã‚µã‚¤ã‚ºæ¤œçŸ¥
- **1347-1402è¡Œ**: è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«å‡¦ç†

### 1400-1600è¡Œ: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã¨ã‚¿ã‚¤ãƒãƒ¼
- **1404-1453è¡Œ**: ğŸ”´ é‡è¦: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆ1410è¡Œã§handleStartSessionã‚’å‘¼ã³å‡ºã—ï¼‰
- **1455-1472è¡Œ**: ã‚¿ã‚¤ãƒãƒ¼ç®¡ç†
- **1474-1491è¡Œ**: è‡ªå‹•ä¿å­˜å‡¦ç†
- **1493-1528è¡Œ**: RealtimeDisplayManagerã‚»ã‚°ãƒ¡ãƒ³ãƒˆã®3è¡Œè¡¨ç¤ºæ›´æ–°
- **1530-1541è¡Œ**: å±¥æ­´ãƒ‡ãƒ¼ã‚¿ã®çµ±åˆ
- **1543-1573è¡Œ**: è¦ç´„ãƒ‡ãƒ¼ã‚¿ã¨è¨€èªè¨­å®šã®ä¿å­˜
- **1580-1589è¡Œ**: ãƒ–ãƒ­ãƒƒã‚¯ã‚¬ã‚¤ãƒ‰ã®éè¡¨ç¤ºã‚¿ã‚¤ãƒãƒ¼
- **1591-1613è¡Œ**: éŒ²éŸ³æ™‚é–“ã®è‡ªå‹•æ›´æ–°

### 1600-1800è¡Œ: ã‚¤ãƒ™ãƒ³ãƒˆãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- **1615-1653è¡Œ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã®è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«
- **1659-1680è¡Œ**: togglePauseé–¢æ•°
- **1683-1689è¡Œ**: formatTimeé–¢æ•°
- **1691-1712è¡Œ**: togglePanelé–¢æ•°ï¼ˆå±¥æ­´/è¦ç´„ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ï¼‰
- **1714-1756è¡Œ**: saveAsMemoé–¢æ•°
- **1758-1765è¡Œ**: saveMemoEdité–¢æ•°
- **1767-1769è¡Œ**: toggleHeaderé–¢æ•°
- **1774-1801è¡Œ**: generateReportã¨generateFinalReporté–¢æ•°

### 1800-2000è¡Œ: ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ
- **1806-1830è¡Œ**: clearAllContenté–¢æ•°
- **1836-1849è¡Œ**: setDisplayã¨changeFonté–¢æ•°
- **1856-1876è¡Œ**: cycleThemeé–¢æ•°ã¨ãƒ†ãƒ¼ãƒæ›´æ–°
- **1884-1899è¡Œ**: adjustFontSizeé–¢æ•°
- **1902-1952è¡Œ**: handleWordExportã¨handlePDFExporté–¢æ•°
- **1955-1984è¡Œ**: ã‚»ã‚¯ã‚·ãƒ§ãƒ³ã‚¯ãƒªãƒƒã‚¯ãƒãƒ³ãƒ‰ãƒ©ãƒ¼
- **1986-1999è¡Œ**: generateQuestionTranslationé–¢æ•°

### 2000-2200è¡Œ: ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°ã¨ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ
- **2007-2016è¡Œ**: splitTexté–¢æ•°
- **2018-2024è¡Œ**: getAlignedHistoryContenté–¢æ•°
- **2026-2082è¡Œ**: getSummaryComparisonContenté–¢æ•°
- **2085-2131è¡Œ**: è‡ªå‹•ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«åˆ¶å¾¡
- **2133-2208è¡Œ**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆCtrl+Shift+Rã§ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒªã‚»ãƒƒãƒˆï¼‰

### 2210-2400è¡Œ: ğŸ”´ é‡è¦ï¼šSetupç”»é¢ã¨ãƒ¡ã‚¤ãƒ³ç”»é¢ã®åˆ†å²
- **2211è¡Œ**: ğŸ”´ æœ€é‡è¦: showSetupãŒtrueã®æ™‚ã®æ¡ä»¶åˆ†å²
- **2212-2229è¡Œ**: SetupSectionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
  - onStartSession={handleStartSession}
  - onResumeSession={handleResumeSession}
  - previousSession={previousSession}
  - sessionMemory={sessionMemory}
- **2231-2258è¡Œ**: CSSãƒ¢ã‚¸ãƒ¥ãƒ¼ãƒ«ç”¨ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
- **2261è¡Œ**: ãƒ¡ã‚¤ãƒ³ç”»é¢ã®returné–‹å§‹
- **2263-2284è¡Œ**: ã‚¢ãƒ—ãƒªã‚³ãƒ³ãƒ†ãƒŠã¨ãƒ¡ã‚¤ãƒ³ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦
- **2286-2400è¡Œ**: ãƒ˜ãƒƒãƒ€ãƒ¼éƒ¨åˆ†ï¼ˆéŒ²éŸ³ã‚¤ãƒ³ã‚¸ã‚±ãƒ¼ã‚¿ãƒ¼ã€ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ãƒœã‚¿ãƒ³ç­‰ï¼‰

### 2400-2600è¡Œ: ãƒ˜ãƒƒãƒ€ãƒ¼ã¨ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«
- **2400-2500è¡Œ**: æˆæ¥­æƒ…å ±è¡¨ç¤ºï¼ˆç§‘ç›®åã€éŒ²éŸ³æ™‚é–“ã€ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³ï¼‰
- **2500-2614è¡Œ**: è¨­å®šãƒœã‚¿ãƒ³ç¾¤ï¼ˆãƒ¬ãƒãƒ¼ãƒˆã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆã€è¡¨ç¤ºãƒ¢ãƒ¼ãƒ‰ã€ãƒ†ãƒ¼ãƒã€ãƒ˜ãƒƒãƒ€ãƒ¼è¡¨ç¤ºï¼‰
- **2616-2670è¡Œ**: ãƒ˜ãƒƒãƒ€ãƒ¼éè¡¨ç¤ºæ™‚ã®ãƒŸãƒ‹ãƒãƒ«ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«

### 2600-2890è¡Œ: ãƒ¡ã‚¤ãƒ³ã‚³ãƒ³ãƒ†ãƒ³ãƒ„ã¨ãƒ¢ãƒ¼ãƒ€ãƒ«
- **2672-2710è¡Œ**: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆRealtimeSectionï¼‰
  - displayContentã€displayOpacityã€volumeLevelç­‰ã®props
  - displayModeã¨themeã®é©ç”¨
- **2712-2740è¡Œ**: ãƒ—ãƒ­ã‚°ãƒ¬ãƒƒã‚·ãƒ–è¦ç´„ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæ¡ä»¶ä»˜ãè¡¨ç¤ºï¼‰
- **2744-2835è¡Œ**: è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³ï¼ˆæŠ˜ã‚ŠãŸãŸã¿å¯èƒ½ï¼‰
  - questionInput textarea
  - ãƒ¡ãƒ¢ä¸€è¦§ã¨è‹±è¨³ã—ã¦ä¿å­˜ãƒœã‚¿ãƒ³
- **2839-2856è¡Œ**: ãƒ•ãƒ­ãƒ¼ãƒ†ã‚£ãƒ³ã‚°ãƒ‘ãƒãƒ«ï¼ˆå±¥æ­´ãƒ‘ãƒãƒ«ã€è¦ç´„ãƒ‘ãƒãƒ«ï¼‰
- **2858-2884è¡Œ**: å„ç¨®ãƒ¢ãƒ¼ãƒ€ãƒ«ï¼ˆãƒ•ãƒ«ã‚¹ã‚¯ãƒªãƒ¼ãƒ³ã€ãƒ¡ãƒ¢ã€ãƒ¬ãƒãƒ¼ãƒˆï¼‰
- **2885-2890è¡Œ**: ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®çµ‚äº†ã¨ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ

## å…¨æ–‡åˆ†æçµæœ

### 1. ğŸ”´ æœ€é‡è¦ç™ºè¦‹ï¼šhandleStartSessionã®é‡è¤‡å®šç¾©

#### é‡è¤‡ã€‘1ï¼š522-623è¡Œï¼ˆå®Œå…¨ç‰ˆï¼‰
```typescript
const handleStartSession = useCallback(async (className: string, sourceLang: string, targetLang: string) => {
  // å®Œå…¨ãªå®Ÿè£…
  // isStartingPipelineãƒ•ãƒ©ã‚°ã®ãƒã‚§ãƒƒã‚¯
  // activeSessionã®ä½œæˆã¨ä¿å­˜
  // SessionMemoryServiceã®é–‹å§‹
  // WindowClient.enterMain()ã®å‘¼ã³å‡ºã—
  // pipeline.startFromMicrophone()ã®å®Ÿè¡Œ
  // ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã¨ãƒ­ãƒ¼ãƒ«ãƒãƒƒã‚¯
}, [pipeline, isStartingPipeline]);
```

#### é‡è¤‡ã€‘2ï¼š1025-1049è¡Œï¼ˆç°¡ç•¥ç‰ˆï¼‰
```typescript
const handleStartSession = useCallback((className: string, sourceLanguage: string, targetLanguage: string) => {
  // ç°¡ç•¥åŒ–ã•ã‚ŒãŸå®Ÿè£…
  // setActiveSessionã®ã¿
  // pipeline.start()ã®å‘¼ã³å‡ºã—ï¼ˆasync/awaitãªã—ï¼‰
}, [pipeline]);
```

### 2. Setupç”»é¢ã‹ã‚‰ã®å‚ç…§
- **2138è¡Œ**: `onStartSession={handleStartSession}`
- **1332è¡Œ**: ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‹ã‚‰ `handleStartSession(selectedClass || '', sourceLanguage, targetLanguage)`

### 3. ç”»é¢é·ç§»ã®åˆ¶å¾¡ãƒ•ãƒ­ãƒ¼
1. **åˆæœŸçŠ¶æ…‹**:
   - activeSession = null (240è¡Œ)
   - showSetup = true (264è¡Œ)
   - èµ·å‹•æ™‚å¼·åˆ¶Setupè¡¨ç¤º (306-310è¡Œ)

2. **useEffectã®é€£é–**:
   - activeSessionå¤‰æ›´æ™‚ã®ãƒ­ã‚°ã¨æ°¸ç¶šåŒ– (270-283è¡Œ)
   - showSetupã‚’activeSessionã«é€£å‹• (285-288è¡Œ)

3. **ç”»é¢åˆ‡ã‚Šæ›¿ãˆæ¡ä»¶**:
   - showSetup = true â†’ SetupSectionè¡¨ç¤º (2211-2229è¡Œ)
   - showSetup = false â†’ ãƒ¡ã‚¤ãƒ³ç”»é¢è¡¨ç¤º (2261è¡Œä»¥é™)

### 4. ä¾å­˜é–¢ä¿‚ã¨å‰¯ä½œç”¨ã®åˆ†æ

#### å®Œå…¨ç‰ˆhandleStartSessionãŒä¾å­˜ã™ã‚‹ã‚‚ã®ï¼š
- pipeline
- isStartingPipelineçŠ¶æ…‹
- sessionMemoryãƒ•ãƒƒã‚¯
- windowClient
- SessionStorageService
- IPCé€šä¿¡ (window.electron.send)

#### ç°¡ç•¥ç‰ˆhandleStartSessionãŒä¾å­˜ã™ã‚‹ã‚‚ã®ï¼š
- pipelineã®ã¿

### 5. ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®é•ã„
- **å®Œå…¨ç‰ˆ**: try-catchã§ã‚¨ãƒ©ãƒ¼ã‚’æ•æ‰ã—ã€å¤±æ•—æ™‚ã¯Setupç”»é¢ã«æˆ»ã‚‹
- **ç°¡ç•¥ç‰ˆ**: ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãªã—

## æ–°ãŸãªç™ºè¦‹äº‹é …ï¼ˆ2025-09-20 åˆ†æï¼‰

### AudioWorkletå®Ÿè£…ã®ç¢ºèª

**çµè«–ï¼šAudioWorkletã¯æ—¢ã«æ­£ã—ãå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹**

`useUnifiedPipeline.ts`ã®åˆ†æã«ã‚ˆã‚Šã€ä»¥ä¸‹ã‚’ç¢ºèªï¼š
- **28è¡Œ**: `import { AudioWorkletProcessor } from '../infrastructure/audio/AudioWorkletProcessor';`
- **1311è¡Œ**: `const processorRef = useRef<IAudioProcessor | null>(null);` - å‹å®‰å…¨ãªå‚ç…§
- **1341-1394è¡Œ**: `AudioWorkletProcessor.create()`ã«ã‚ˆã‚‹å®Ÿè£…
- **å‹å®‰å…¨æ€§**: `as any`ã‚’ä½¿ç”¨ã›ãšã€`IAudioProcessor`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã§æŠ½è±¡åŒ–

### WebkitAppRegionå‹å®‰å…¨æ€§ã®å•é¡Œ

~~**ç™ºè¦‹ï¼š11ç®‡æ‰€ã§`as any`ãŒä½¿ç”¨ã•ã‚Œã¦ã„ã‚‹**~~
**è§£æ±ºæ¸ˆã¿ï¼ˆ2025-09-21ï¼‰ï¼šå…¨ã¦ã®`as any`ã‚’é™¤å»**

1. ~~**2208è¡Œ**: `WebkitAppRegion: 'drag' as any` - ãƒ˜ãƒƒãƒ€ãƒ¼ã‚’ãƒ‰ãƒ©ãƒƒã‚°å¯èƒ½ã«~~
2. ~~**2223è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - ä¸€æ™‚åœæ­¢ãƒœã‚¿ãƒ³~~
3. ~~**2237è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - æˆæ¥­çµ‚äº†ãƒœã‚¿ãƒ³~~
4. ~~**2245è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - æ¬¡ã®æˆæ¥­ã¸ãƒœã‚¿ãƒ³~~
5. ~~**2273è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - å±¥æ­´ãƒœã‚¿ãƒ³~~
6. ~~**2288è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - è¦ç´„ãƒœã‚¿ãƒ³~~
7. ~~**2304è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - è³ªå•ãƒœã‚¿ãƒ³~~
8. ~~**2366è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - è¨­å®šãƒãƒ¼~~
9. ~~**2479è¡Œ**: `WebkitAppRegion: 'drag' as any` - ãƒŸãƒ‹ãƒãƒ«ãƒ˜ãƒƒãƒ€ãƒ¼~~
10. ~~**2524è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - ãƒ˜ãƒƒãƒ€ãƒ¼å¾©å…ƒãƒœã‚¿ãƒ³~~
11. ~~**2562è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã‚»ã‚¯ã‚·ãƒ§ãƒ³~~
12. ~~**2641è¡Œ**: `WebkitAppRegion: 'no-drag' as any` - è³ªå•ã‚»ã‚¯ã‚·ãƒ§ãƒ³~~

**è§£æ±ºæ–¹æ³•**: `src/types/global.d.ts`ã«æ—¢å­˜ã®å‹å®šç¾©ãŒã‚ã‚‹ã“ã¨ã‚’ç¢ºèªã—ã€å…¨ã¦ã®`as any`ã‚’å‰Šé™¤

## æ¨æ¸¬ã•ã‚Œã‚‹å•é¡Œã®æ ¹æœ¬åŸå› 

ã‚³ãƒ¼ãƒ‰ã®æ§‹é€ ã‹ã‚‰ã€ä»¥ä¸‹ã®ã‚ˆã†ãªå•é¡ŒãŒç™ºç”Ÿã—ã¦ã„ã‚‹å¯èƒ½æ€§ãŒé«˜ã„ï¼š

1. **JavaScriptã®å¤‰æ•°å·»ãä¸Šã’**: åŒåã®é–¢æ•°ãŒ2ã¤å®šç¾©ã•ã‚Œã¦ã„ã‚‹å ´åˆã€å¾Œã®å®šç¾©ãŒå„ªå…ˆã•ã‚Œã‚‹
2. **ç°¡ç•¥ç‰ˆãŒä½¿ã‚ã‚Œã¦ã„ã‚‹**: SetupSectionã‹ã‚‰ã¯handleStartSessionãŒå‘¼ã°ã‚Œã‚‹ãŒã€ãã‚Œã¯1025è¡Œã®ç°¡ç•¥ç‰ˆ
3. **ç°¡ç•¥ç‰ˆã®å•é¡Œ**:
   - WindowClient.enterMain()ãŒå‘¼ã°ã‚Œãªã„
   - ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ã‚µã‚¤ã‚ºå¤‰æ›´ãŒå®Ÿè¡Œã•ã‚Œãªã„
   - SessionMemoryServiceãŒé–‹å§‹ã•ã‚Œãªã„
   - isStartingPipelineãƒ•ãƒ©ã‚°ãŒç®¡ç†ã•ã‚Œãªã„
   - ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒãªã„

### 6. ãã®ä»–ã®é‡è¦ãªç™ºè¦‹
- endSessionã€nextClassã€handleResumeSessionã‚‚é‡è¤‡å®šç¾©ãŒã‚ã‚‹
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã®useEffectã®ä¾å­˜é…åˆ—ãŒä¸å®Œå…¨ï¼ˆ1453è¡Œï¼‰
- ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦ãƒªã‚µã‚¤ã‚ºç®¡ç†ãŒè¤‡é›‘ã§ã€activeSessionãŒãªã„å ´åˆã®å‡¦ç†ãŒå¤šæ•°å­˜åœ¨

## Clean Architectureè¦³ç‚¹ã‹ã‚‰ã®è§£æ±ºç­–ææ¡ˆ

### 1. å‰Šé™¤ã™ã¹ãé‡è¤‡é–¢æ•°ï¼ˆ1025-1076è¡Œï¼‰
ä»¥ä¸‹ã®ç°¡ç•¥ç‰ˆé–¢æ•°ã¯å…¨ã¦å‰Šé™¤ã™ã¹ãï¼š
- handleStartSessionï¼ˆ1025-1049è¡Œï¼‰
- handleResumeSessionï¼ˆ1052-1055è¡Œï¼‰
- endSessionï¼ˆ1058-1069è¡Œï¼‰
- nextClassï¼ˆ1072-1076è¡Œï¼‰

**ç†ç”±**ï¼š
- å®Œå…¨ç‰ˆã®æ–¹ãŒè²¬ä»»ã‚’é©åˆ‡ã«åˆ†é›¢ã—ã¦ã„ã‚‹
- SessionMemoryServiceã¨ã®çµ±åˆãŒé©åˆ‡
- ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- ä¾å­˜æ€§æ³¨å…¥ãƒ‘ã‚¿ãƒ¼ãƒ³ã«æº–æ‹ 

### 2. æ®‹ã™ã¹ãå®Ÿè£…ã®ç‰¹å¾´

#### handleStartSessionï¼ˆ522-623è¡Œï¼‰ã®è²¬ä»»åˆ†é›¢ï¼š
1. **UIçŠ¶æ…‹ç®¡ç†**: setActiveSessionã€setShowSetupç­‰
2. **æ°¸ç¶šåŒ–**: sessionStorageServiceçµŒç”±
3. **ã‚»ãƒƒã‚·ãƒ§ãƒ³ãƒ¡ãƒ¢ãƒª**: sessionMemory.startSession
4. **ã‚¦ã‚£ãƒ³ãƒ‰ã‚¦åˆ¶å¾¡**: windowClient.enterMain
5. **ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³åˆ¶å¾¡**: pipeline.startFromMicrophone
6. **IPCé€šä¿¡**: window.electron.send

#### Clean Architectureã®å±¤æ§‹é€ ã®éµå®ˆï¼š
- **UIå±¤**: çŠ¶æ…‹ç®¡ç†ã¨ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- **ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤**: ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³ã¨ã‚»ãƒƒã‚·ãƒ§ãƒ³ç®¡ç†
- **ã‚¤ãƒ³ãƒ•ãƒ©å±¤**: IPCã€æ°¸ç¶šåŒ–ã€å¤–éƒ¨API

### 3. ä¿®æ­£æ™‚ã®æ³¨æ„ç‚¹

#### ä¾å­˜é–¢ä¿‚ã®ç¢ºèªï¼š
- useCallbackã®ä¾å­˜é…åˆ—ï¼š`[pipeline, isStartingPipeline, sessionMemory]`
- ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼ˆ1410è¡Œï¼‰ã®å‚ç…§æ›´æ–°
- SetupSectionã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã¸ã®propsç¢ºèª

#### å‰¯ä½œç”¨ã®è€ƒæ…®ï¼š
- recordingStartTimeRefã®åˆæœŸåŒ–ã‚¿ã‚¤ãƒŸãƒ³ã‚°
- showBlockGuidesã®è¡¨ç¤ºåˆ¶å¾¡
- è‡ªå‹•ä¿å­˜æ©Ÿèƒ½ã¨ã®é€£æº

### 4. å®Ÿè£…æ‰‹é †ï¼ˆæ¨å¥¨ï¼‰

1. **ãƒãƒƒã‚¯ã‚¢ãƒƒãƒ—ä½œæˆ**
2. **ç°¡ç•¥ç‰ˆé–¢æ•°ã®å‰Šé™¤**ï¼ˆ1025-1076è¡Œï¼‰
3. **ä¾å­˜é…åˆ—ã®ä¿®æ­£**ï¼š
   ```typescript
   // 623è¡Œã®ä¾å­˜é…åˆ—ã« sessionMemory ã‚’è¿½åŠ 
   }, [pipeline, isStartingPipeline, sessionMemory]);
   ```
4. **handleEndSessioné–¢æ•°åã®çµ±ä¸€**ï¼š
   - 802è¡Œã®handleEndSessionã‚’endSessionã«å¤‰æ›´
   - ã¾ãŸã¯é€†ã«ã€å…¨ã¦handleEndSessionã«çµ±ä¸€
5. **ãƒ†ã‚¹ãƒˆå®Ÿæ–½**ï¼š
   - Setupç”»é¢ã‹ã‚‰ã®é·ç§»
   - ã‚­ãƒ¼ãƒœãƒ¼ãƒ‰ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆå‹•ä½œ
   - ã‚»ãƒƒã‚·ãƒ§ãƒ³å†é–‹æ©Ÿèƒ½

### 5. å°†æ¥çš„ãªæ”¹å–„ææ¡ˆ

1. **ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆåˆ†å‰²**ï¼š
   - 2776è¡Œã¯å¤§ãã™ãã‚‹
   - ãƒ­ã‚¸ãƒƒã‚¯ã¨UIã®åˆ†é›¢
   - ã‚«ã‚¹ã‚¿ãƒ ãƒ•ãƒƒã‚¯ã¸ã®æŠ½å‡º

2. **çŠ¶æ…‹ç®¡ç†ã®æ”¹å–„**ï¼š
   - useReducerãƒ‘ã‚¿ãƒ¼ãƒ³ã®æ¡ç”¨
   - çŠ¶æ…‹ã®æ­£è¦åŒ–

3. **ã‚¨ãƒ©ãƒ¼ãƒã‚¦ãƒ³ãƒ€ãƒªã®å®Ÿè£…**ï¼š
   - ç•°å¸¸çµ‚äº†æ™‚ã®å¾©æ—§
   - ãƒ¦ãƒ¼ã‚¶ãƒ¼ãƒ•ãƒ¬ãƒ³ãƒ‰ãƒªãƒ¼ãªã‚¨ãƒ©ãƒ¼è¡¨ç¤º

4. **WebkitAppRegionå‹å®šç¾©ã®è¿½åŠ **ï¼š
   ```typescript
   // global.d.ts ã¾ãŸã¯é©åˆ‡ãªå‹å®šç¾©ãƒ•ã‚¡ã‚¤ãƒ«ã«è¿½åŠ 
   declare module 'react' {
     interface CSSProperties {
       WebkitAppRegion?: 'drag' | 'no-drag';
     }
   }
   ```

5. **useUnifiedPipelineã®åˆ†å‰²**ï¼ˆ1596è¡Œï¼‰ï¼š
   - useAudioCapture: éŸ³å£°å…¥åŠ›ç®¡ç†ï¼ˆ1313-1426è¡Œï¼‰
   - useRealtimeTranscription: ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ æ–‡å­—èµ·ã“ã—
   - useTranslationQueue: ç¿»è¨³ã‚­ãƒ¥ãƒ¼ç®¡ç†
   - useSummaryGeneration: è¦ç´„ç”Ÿæˆ

## é‡è¦ãªå®Ÿè£…è©³ç´°ï¼ˆ2025-09-20è¿½è¨˜ï¼‰

### AudioWorkletå®Ÿè£…ã®ç‰¹å¾´

1. **Clean Architectureæº–æ‹ **ï¼š
   - ãƒ‰ãƒ¡ã‚¤ãƒ³å±¤: `IAudioProcessor`ã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹
   - ã‚¤ãƒ³ãƒ•ãƒ©å±¤: `AudioWorkletProcessor`å®Ÿè£…
   - ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³å±¤: `useUnifiedPipeline`ã§ã®ä½¿ç”¨

2. **å‹å®‰å…¨ãªå®Ÿè£…**ï¼š
   ```typescript
   const processorRef = useRef<IAudioProcessor | null>(null);
   // ScriptProcessorNodeã§ã¯ãªãã€æŠ½è±¡åŒ–ã•ã‚ŒãŸã‚¤ãƒ³ã‚¿ãƒ¼ãƒ•ã‚§ãƒ¼ã‚¹ã‚’ä½¿ç”¨
   ```

3. **ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸å‹ã®å®šç¾©**ï¼š
   ```typescript
   interface AudioProcessorMessage {
     type: 'initialized' | 'audio' | 'error' | 'stop';
     data?: any;
   }
   ```

### ãƒœãƒˆãƒ ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã®æ–°å®Ÿè£…ï¼ˆ2025-09-19ï¼‰

- **332-341è¡Œ**: `useBottomResize`ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨
- **2588-2597è¡Œ**: ãƒªã‚µã‚¤ã‚ºãƒãƒ³ãƒ‰ãƒ«ã®ãƒ¬ãƒ³ãƒ€ãƒªãƒ³ã‚°
- Clean ArchitectureåŸå‰‡ã«å¾“ã„ã€æ°¸ç¶šåŒ–ãƒ­ã‚¸ãƒƒã‚¯ã¯å¤–éƒ¨ã‹ã‚‰æ³¨å…¥

### HeaderControlsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®æŠ½å‡º

- **22è¡Œ**: `import { HeaderControls } from './UniVoice/Header/HeaderControls/HeaderControls';`
- **268-279è¡Œ**: `useHeaderControls`ãƒ•ãƒƒã‚¯ã®ä½¿ç”¨
- **2330-2352è¡Œ**: HeaderControlsã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã®ä½¿ç”¨
- æ®µéšçš„ãƒªãƒ•ã‚¡ã‚¯ã‚¿ãƒªãƒ³ã‚°ã®è‰¯ã„ä¾‹

## å‹å®‰å…¨æ€§æ”¹å–„ã®å®Ÿæ–½ï¼ˆ2025-09-21ï¼‰

### 1. document.getElementByIdã®ç½®ãæ›ãˆ

**æ”¹å–„å‰**:
```typescript
// 1636è¡Œ
const textarea = document.getElementById('questionInput') as HTMLTextAreaElement;
// 1747è¡Œ
const textarea = document.getElementById('questionInput') as HTMLTextAreaElement;
```

**æ”¹å–„å¾Œ**:
```typescript
// 296è¡Œ: refã®è¿½åŠ 
const questionInputRef = useRef<HTMLTextAreaElement>(null);

// 1639è¡Œ: saveAsMemoé–¢æ•°
const textarea = questionInputRef.current;

// 1750è¡Œ: å…¥åŠ›æ¬„ã‚¯ãƒªã‚¢å‡¦ç†
const textarea = questionInputRef.current;

// 2654è¡Œ: textareaè¦ç´ 
<textarea ref={questionInputRef} ... />
```

**æ”¹å–„ç†ç”±**:
- Reactã®ã‚¢ãƒ³ãƒãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆdocument.getElementByIdï¼‰ã‚’æ’é™¤
- å‹å®‰å…¨æ€§ã®å‘ä¸Šï¼ˆnullãƒã‚§ãƒƒã‚¯ãŒæ˜ç¢ºã«ï¼‰
- Clean ArchitectureåŸå‰‡ã«æº–æ‹ ï¼ˆDOMæ“ä½œã®æŠ½è±¡åŒ–ï¼‰

### 2. window.univoice ã®å‹å®‰å…¨æ€§æ”¹å–„

**æ”¹å–„å‰**:
```typescript
// 807è¡Œ
const univoiceApi = (window as any).univoice;
```

**æ”¹å–„å¾Œ**:
```typescript
const univoiceApi = window.univoice;
```

**æ”¹å–„ç†ç”±**:
- `src/types/global.d.ts`ã®å‹å®šç¾©ã‚’æ´»ç”¨
- å‹ãƒã‚§ãƒƒã‚¯ã«ã‚ˆã‚‹å®‰å…¨æ€§å‘ä¸Š

### 3. ç·æ‹¬

2025-09-21ã®æ”¹å–„ã«ã‚ˆã‚Šã€ä»¥ä¸‹ã‚’é”æˆï¼š
- **å…¨ã¦ã®`as any`ã‚’æ’é™¤**ï¼ˆWebkitAppRegionã€window.univoiceï¼‰
- **document.getElementByIdã‚’useRefã«ç½®ãæ›ãˆ**
- **TypeScript strictãƒ¢ãƒ¼ãƒ‰ã§ã®ã‚³ãƒ³ãƒ‘ã‚¤ãƒ«ã‚¨ãƒ©ãƒ¼ã‚¼ãƒ­**

ã“ã‚Œã‚‰ã®æ”¹å–„ã«ã‚ˆã‚Šã€æŠ€è¡“çš„è² å‚µã‚’å‰Šæ¸›ã—ã€ä¿å®ˆæ€§ã¨å‹å®‰å…¨æ€§ã‚’å‘ä¸Šã•ã›ã¾ã—ãŸã€‚