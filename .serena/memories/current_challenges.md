# UniVoice 2.0 現在の課題と注意点

## 🚧 実装中/未実装の機能

### 1. 左右位置揃え・タイミング同期
- **課題**: 原文と翻訳の表示タイミングがずれる
- **影響**: ユーザー体験の低下
- **対策**: 高さ調整とタイミング制御の実装が必要

### 2. UIへの単語帳・レポート表示
- **現状**: ボタンは追加済み、表示UIは未実装
- **必要な作業**:
  - UniVoicePerfect.tsxに表示セクション追加
  - Markdown→HTML変換の実装
  - ダウンロード機能の実装

## ⚠️ 技術的な注意事項

### 1. CLAUDE.mdの誤解を招く記述
- **問題**: Responses APIの存在について誤解を招く可能性
- **対策**: 冒頭に強烈な警告セクションを追加予定
- **重要**: Responses API、GPT-5シリーズは実在する

### 2. 要約仕様の正確な理解
- **正しい仕様**:
  - 400/800/1600語での要約生成
  - 1600語以降は800語ごとに追加
  - 前回の要約＋新しい800語を合わせて要約
- **誤解**: 10分ごとの定期要約（これは不要）

### 3. 型定義の重複
- **問題**: contracts.tsがelectron側とsrc/shared側に重複
- **影響**: メンテナンス性の低下
- **将来**: 統合が必要

## 🔴 絶対的な制約事項

### 1. 親フォルダ参照の禁止
- **理由**: 親フォルダは近日削除予定
- **対策**: 
  - 参照データは docs/parent-reference/ に配置済み
  - 必要なコードはコピーしてUniVoice内で独立実装

### 2. メモリ使用量
- **課題**: ビルド時に4GBのメモリが必要
- **対策**: NODE_OPTIONS=--max-old-space-size=4096
- **注意**: 長時間録音時のメモリ監視が重要

### 3. APIレート制限
- **リスク**: OpenAI APIのレート制限
- **対策**: 
  - 並列処理数の適切な制限（デフォルト3）
  - 本番環境では制限値の調整が必要

## 📈 パフォーマンス改善の余地

### 1. StreamCoalescerの調整
- **現状**: デバウンス160ms、強制コミット1100ms
- **改善**: 用途に応じた動的調整の検討

### 2. 翻訳キューの最適化
- **現状**: 最大3並列
- **検討**: ネットワーク状況に応じた動的調整

## 🎯 今後の優先事項

### Phase 2の完了（現在実装中）
1. ✅ 単語数ベース要約（実装済み）
2. ✅ 語彙抽出（実装済み）
3. ✅ 最終レポート生成（実装済み）
4. ❌ データ永続化（未実装）
5. ❌ UI表示の完成（部分的に未実装）

### Phase 3の計画
- パフォーマンス最適化
- エラー回復機能
- Docker環境整備
- CI/CDパイプライン構築

## 💡 開発時の注意点

### 1. 命名規則の改善
- **問題**: UniVoicePerfect.tsxという格好悪い名前
- **推奨**: UniVoice.tsxへのリネーム

### 2. エラーハンドリングの統一
- **現状**: 一部でtry-catchのみ使用
- **推奨**: Result型パターンへの統一

### 3. ログの活用
- **場所**: logs/univoice-YYYY-MM-DD.jsonl
- **活用**: デバッグ時の問題追跡に重要

## 🐛 既知の問題

### 1. temperature パラメータ
- **問題**: GPT-5では使用不可（1.0固定）
- **対策**: 全てのOpenAI API呼び出しから削除済み

### 2. any型の残存
- **問題**: PipelineEventのdata: any
- **影響**: 型安全性の低下
- **対策**: 適切な型定義への置き換えが必要

### 3. Windows固有の問題
- **注意**: パス区切り文字の違い
- **対策**: path.join()の使用を徹底