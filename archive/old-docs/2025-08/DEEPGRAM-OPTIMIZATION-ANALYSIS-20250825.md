# Deepgram パラメータ最適化分析

## 実施日時
2025-08-25

## 現状の設定
```javascript
// 現在の設定
endpointing: 800ms
utterance_end_ms: 1000ms
interim_results: true
punctuate: true
diarize: true
smart_format: false (未使用)
```

## 推奨される変更

### 1. **endpointing: 800ms → 300ms**
- **理由**: 現在の800msは長すぎて応答性が低い
- **効果**: より迅速な音声区切り検出
- **注意**: 雑音に影響されやすくなる可能性

### 2. **UtteranceEndの活用**
- **現状**: speech_finalのみに依存
- **改善**: UtteranceEndイベントを主要な発話区切りとして使用
- **利点**: タイムスタンプベースで雑音に強い

### 3. **smart_format: true**
- **効果**: 数値、日付、通貨の可読性向上
- **注意**: エンティティ完了まで最大3秒の遅延可能性
- **対策**: 教育現場では問題になりにくい

### 4. **発話区切りの優先順位**
1. UtteranceEnd（最優先）
2. speech_final（補助）
3. is_final（文の確定更新として扱う）

## 実装時の注意点

### イベント処理の改善
```javascript
// 現在: is_finalを発話区切りとして誤用
// 改善: UtteranceEndを主要トリガーに
if (msg?.type === 'UtteranceEnd') {
  // 発話区切り処理
}
```

### パフォーマンスへの影響
- endpointing短縮により処理頻度増加
- smart_formatによる若干の遅延
- 全体的には応答性向上が期待される

## リスク評価
- **低リスク**: パラメータ調整のみ
- **互換性**: 既存コードへの影響最小限
- **ロールバック**: 容易

## 実装判断
現時点では情報収集と分析に留め、以下の理由により実装は保留：

1. **現在のシステムが安定動作中**
2. **ユーザーから具体的な問題報告なし**
3. **パラメータ変更は慎重に行うべき**

将来的に応答性の改善要望があった場合に、この分析を基に実装を検討する。